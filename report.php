<?php
// report.php
$ipAddress = $_GET['ip_address'];

// Connect to the MySQL database
$servername = "localhost";
$username = "sally";
$password = "Violets2_";
$dbname = "nmap_reports";

$conn = new mysqli($servername, $username, $password, $dbname);

// Check the connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// Prepare the SQL statement
$stmt = $conn->prepare("SELECT * FROM scan_results WHERE ip_address = ?");
$stmt->bind_param("s", $ipAddress);

// Execute the SQL statement
$stmt->execute();

// Fetch the results
$result = $stmt->get_result();
$row = $result->fetch_assoc();

// Format the retrieved data to generate the report
$report = <<<EOT
==================================================
                   Nmap Penetration Test Report
==================================================

Date: July 2, 2023
Penetration Tester: John Doe
Client: XYZ Company
Target System: $ipAddress

1. Executive Summary:
----------------------
...

2. Scope:
-----------
...

3. Methodology:
----------------
...

4. Findings:
--------------
4.1 Open Ports:
EOT;

// Add open ports to the report
foreach ($openPorts as $port) {
    $report .= "\n- Port $port/tcp: Service is running.";
}

$report .= "\n\n4.2 Service Enumeration:";

// Add services to the report
foreach ($services as $service) {
    $report .= "\n- $service";
}

$report .= "\n\n4.3 Vulnerability Assessment:";

// Add vulnerabilities to the report
foreach ($vulnerabilities as $vulnerability) {
    $report .= "\n- $vulnerability";
}

$report .= <<<EOT

5. Recommendations:
---------------------
...

6. Conclusion:
----------------
...

Please note that this report is based on the findings and observations from the Nmap penetration test conducted on a specific date. Regular security assessments are crucial to ensure the ongoing security of the target system.

==================================================
EOT;

echo nl2br($report);

// Close the database connection
$stmt->close();
$conn->close();
